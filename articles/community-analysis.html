<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phylogenetic community assembly with the Fish Tree of Life • fishtree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Phylogenetic community assembly with the Fish Tree of Life">
<meta property="og:description" content="fishtree">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fishtree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.4.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/community-analysis.html">Phylogenetic community assembly with the Fish Tree of Life</a>
    </li>
    <li>
      <a href="../articles/comparative-analysis.html">A simple comparative analysis with the Fish Tree of Life</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonchang/fishtree/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="community-analysis_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Phylogenetic community assembly with the Fish Tree of Life</h1>
                        <h4 class="author">Jonathan Chang</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jonchang/fishtree/blob/master/vignettes/community-analysis.Rmd"><code>vignettes/community-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>community-analysis.Rmd</code></div>

    </div>

    
    
<p>Here’s a quick example to show how we could use the <code>fishtree</code> package to conduct some phylogenetic community analyses. First, we load <code>fishtree</code> and ensure that the other packages that we need are installed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/">ape</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fishtreeoflife.org/">fishtree</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">loadNamespace</a></span><span class="op">(</span><span class="st">"rfishbase"</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: namespace:rfishbase&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">loadNamespace</a></span><span class="op">(</span><span class="st">"picante"</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: namespace:picante&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">loadNamespace</a></span><span class="op">(</span><span class="st">"geiger"</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: namespace:geiger&gt;</span></code></pre></div>
<p>Next we’ll start downloading some data from <code>rfishbase</code>. We’ll be seeing if reef-associated ray-finned fish species are clustered or overdispersed in the Atlantic, Pacific, and Indian Oceans.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get reef-associated species from the `species` table</span>
<span class="va">reef_species</span> <span class="op">&lt;-</span> <span class="fu">rfishbase</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rfishbase/reference/species.html">species</a></span><span class="op">(</span>fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"DemersPelag"</span><span class="op">)</span><span class="op">)</span>
<span class="va">reef_species</span> <span class="op">&lt;-</span> <span class="va">reef_species</span><span class="op">[</span><span class="va">reef_species</span><span class="op">$</span><span class="va">DemersPelag</span> <span class="op">==</span> <span class="st">"reef-associated"</span>, <span class="op">]</span>

<span class="co"># Get native and endemic species from the Atlantic, Pacific, and Indian Oceans</span>
<span class="va">eco</span> <span class="op">&lt;-</span> <span class="fu">rfishbase</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rfishbase/reference/ecosystem.html">ecosystem</a></span><span class="op">(</span>species_list <span class="op">=</span> <span class="va">reef_species</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="va">valid_idx</span> <span class="op">&lt;-</span> <span class="va">eco</span><span class="op">$</span><span class="va">Status</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"native"</span>, <span class="st">"endemic"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">eco</span><span class="op">$</span><span class="va">EcosystemName</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Atlantic Ocean"</span>, <span class="st">"Pacific Ocean"</span>, <span class="st">"Indian Ocean"</span><span class="op">)</span> 
<span class="va">eco</span> <span class="op">&lt;-</span> <span class="va">eco</span><span class="op">[</span><span class="va">valid_idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"EcosystemName"</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Retrieve the phylogeny of only native reef species across all three oceans.</span>
<span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fishtree_phylogeny.html">fishtree_phylogeny</a></span><span class="op">(</span>species <span class="op">=</span> <span class="va">eco</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="co">#&gt; Warning: Requested 5813 but only found 3961 species.</span>
<span class="co">#&gt; * Ablabys binotatus</span>
<span class="co">#&gt; * Ablabys macracanthus</span>
<span class="co">#&gt; * Ablabys taenianotus</span>
<span class="co">#&gt; * Abudefduf conformis</span>
<span class="co">#&gt; * Abudefduf natalensis</span>
<span class="co">#&gt; * ...and 1847 others</span></code></pre></div>
<p>We’ll have to clean up the data in a few ways before sending it to <code>picante</code> for analysis. First, we’ll need to convert our species-by-site data frame into a presence-absence matrix. We’ll use <code><a href="https://rdrr.io/r/base/table.html">base::table</a></code> for this, and use <code>unclass</code> to convert the <code>table</code> into a standard <code>matrix</code> object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">unclass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">eco</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">sample_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">Species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">sample_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">Species</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Next, we’ll use <code><a href="https://rdrr.io/pkg/geiger/man/name.check.html">geiger::name.check</a></code> to ensure the tip labels of the phylogeny and the rows of the data matrix match each other.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">geiger</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geiger/man/name.check.html">name.check</a></span><span class="op">(</span><span class="va">phy</span>, <span class="va">sample_matrix</span><span class="op">)</span>
<span class="va">sample_matrix</span> <span class="op">&lt;-</span> <span class="va">sample_matrix</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sample_matrix</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">nc</span><span class="op">$</span><span class="va">data_not_tree</span>, <span class="op">]</span></code></pre></div>
<p>Finally, we’ll generate the cophenetic matrix based on the phylogeny, and transpose the presence-absence matrix since <code>picante</code> likes its columns to be species and its rows to be sites.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cophen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cophenetic.html">cophenetic</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span>
<span class="va">sample_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">sample_matrix</span><span class="op">)</span></code></pre></div>
<p>We’ll run <code><a href="https://rdrr.io/pkg/picante/man/ses.mpd.html">picante::ses.mpd</a></code> and <code><a href="https://rdrr.io/pkg/picante/man/ses.mntd.html">picante::ses.mntd</a></code> with only 100 iterations, to speed up the analysis. For a real analysis you would likely increase this to 1000, and possibly test other null models if your datasets have e.g., abundance information.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">picante</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/picante/man/ses.mpd.html">ses.mpd</a></span><span class="op">(</span><span class="va">sample_matrix</span>, <span class="va">cophen</span>, null.model <span class="op">=</span> <span class="st">"taxa.labels"</span>, runs <span class="op">=</span> <span class="fl">99</span><span class="op">)</span>
<span class="co">#&gt;                ntaxa  mpd.obs mpd.rand.mean mpd.rand.sd mpd.obs.rank</span>
<span class="co">#&gt; Atlantic Ocean   623 238.1682      232.0108   2.0130149          100</span>
<span class="co">#&gt; Indian Ocean    1213 233.1537      231.6344   1.1962457           92</span>
<span class="co">#&gt; Pacific Ocean   1497 231.6829      231.7255   0.8562859           49</span>
<span class="co">#&gt;                  mpd.obs.z mpd.obs.p runs</span>
<span class="co">#&gt; Atlantic Ocean  3.05877191      1.00   99</span>
<span class="co">#&gt; Indian Ocean    1.27007616      0.92   99</span>
<span class="co">#&gt; Pacific Ocean  -0.04975518      0.49   99</span>
<span class="fu">picante</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/picante/man/ses.mntd.html">ses.mntd</a></span><span class="op">(</span><span class="va">sample_matrix</span>, <span class="va">cophen</span>, null.model <span class="op">=</span> <span class="st">"taxa.labels"</span>, runs <span class="op">=</span> <span class="fl">99</span><span class="op">)</span>
<span class="co">#&gt;                ntaxa mntd.obs mntd.rand.mean mntd.rand.sd mntd.obs.rank</span>
<span class="co">#&gt; Atlantic Ocean   623 41.86956       48.39961    1.4602454             1</span>
<span class="co">#&gt; Indian Ocean    1213 34.99129       38.07913    0.6401552             1</span>
<span class="co">#&gt; Pacific Ocean   1497 34.08644       35.11062    0.5876399             3</span>
<span class="co">#&gt;                mntd.obs.z mntd.obs.p runs</span>
<span class="co">#&gt; Atlantic Ocean  -4.471888       0.01   99</span>
<span class="co">#&gt; Indian Ocean    -4.823588       0.01   99</span>
<span class="co">#&gt; Pacific Ocean   -1.742869       0.03   99</span></code></pre></div>
<p>The Atlantic and Indian Oceans are overdispersed using the MPD metric, and all three oceans are clustered under the MNTD metric. MPD is thought to be more sensitive to patterns closer to the root of the tree, while MNTD is thought to more closely reflect patterns towards the tips of the phylogeny.</p>
<p>We can confirm these patterns visually by running the following code, which will plot the phylogeny and add colored dots (red, green, and blue) to indicate whether a tip is associated with a specific ocean basin.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">phy</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="st">"last_plot.phylo"</span>, <span class="va">.PlotPhyloEnv</span><span class="op">)</span>

<span class="va">matr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">sample_matrix</span><span class="op">)</span><span class="op">[</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.label</span>, <span class="op">]</span>
<span class="va">xx</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">xx</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">obj</span><span class="op">$</span><span class="va">Ntip</span><span class="op">]</span>
<span class="va">yy</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">yy</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">obj</span><span class="op">$</span><span class="va">Ntip</span><span class="op">]</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1b9e77"</span>, <span class="st">"#d95f02"</span>, <span class="st">"#7570b3"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">matr</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">present_idx</span> <span class="op">&lt;-</span> <span class="va">matr</span><span class="op">[</span>, <span class="va">ii</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">xx</span><span class="op">[</span><span class="va">present_idx</span><span class="op">]</span> <span class="op">+</span> <span class="va">ii</span>, <span class="va">yy</span><span class="op">[</span><span class="va">present_idx</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span>, cex <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="community-analysis_files/figure-html/plot-1.png" width="672"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Chang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
